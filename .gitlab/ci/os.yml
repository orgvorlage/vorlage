#-------------------------------------------------------------------------------
# SPDX-License-Identifier: "Apache-2.0 OR MIT"
# Copyright (C) 2020, Jayesh Badwaik <jayesh@badwaik.in>
#-------------------------------------------------------------------------------

# Generic OS Configuration
.os:
  stage: Test
  image: $DOCKER_USER/$OS_NAME:$CXX_STANDARD
  extends: .container
  script:
    - |
      ci/bin/os \
        $CXX_STANDARD \
        $BUILD_TYPE \
        $COVERAGE \
        $PWD \
        $WORKING_DIRECTORY
    - |
      if [[ $COVERAGE == On ]]; then
        ci/bin/compute.coverage \
          -i $WORKING_DIRECTORY/artifact/coverage/unit.t/unit.t.json \
          -o $WORKING_DIRECTORY/artifact/coverage/unit.t/unit.t.log
        mkdir -p artifact/coverage/$COMPILER/$RELEASE/$CXX_STANDARD/
        rsync -aAX \
          $WORKING_DIRECTORY/artifact/ \
          artifact/coverage/$COMPILER/$RELEASE/$CXX_STANDARD/
      fi

# OS List
.archlinux.latest:
  extends: .os
  variables:
    OS_NAME: archlinux.latest

.centos.8:
  extends: .os
  variables:
    OS_NAME: centos.8

.ubuntu.20.04:
  extends: .os
  variables:
    OS_NAME: ubuntu.20.04
